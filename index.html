<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOIF MyBarFinder - Montpellier</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0f24 0%, #2d1b3d 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 500px; margin: 0 auto; background: #1a0f24; min-height: 100vh; }
        .header {
            background: linear-gradient(135deg, #4a0e4e 0%, #81236e 40%, #ab2567 70%, #ff006e 100%);
            padding: 40px 24px 30px;
            text-align: center;
        }
        .header h1 { font-size: 48px; font-weight: 200; letter-spacing: 12px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .tabs {
            display: flex;
            background: #21152f;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab {
            flex: 1; padding: 16px; text-align: center; background: transparent; border: none;
            color: rgba(255, 255, 255, 0.5); font-weight: 600; cursor: pointer; font-size: 14px;
            transition: all 0.3s; position: relative;
        }
        .tab.active { color: #fff; }
        .tab.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
        }
        .content { padding: 24px; display: none; }
        .content.active { display: block; }
        .btn-primary {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 16px;
            cursor: pointer; margin-bottom: 16px; transition: transform 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary {
            width: 100%; padding: 16px; background: rgba(255,255,255,0.1); color: white;
            border: none; border-radius: 12px; font-weight: 700; font-size: 16px;
            cursor: pointer; margin-top: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        .form-input {
            width: 100%; padding: 12px 16px; border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.05);
            color: white; font-size: 14px;
        }
        .form-input:focus { outline: none; border-color: #ff8e8e; }
        .form-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .category { margin-bottom: 25px; }
        .category-title {
            font-weight: 700; font-size: 15px; margin-bottom: 12px; color: #ff8e8e;
            padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .filter-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .filter-item {
            display: flex; align-items: center; gap: 8px; padding: 10px;
            background: rgba(255, 255, 255, 0.03); border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08); cursor: pointer; transition: all 0.2s;
        }
        .filter-item:hover { background: rgba(255, 255, 255, 0.08); }
        .filter-item.active {
            background: rgba(255, 107, 107, 0.3); border-color: rgba(255, 107, 107, 0.5);
        }
        .filter-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; display: none; }
        .filter-item label { font-size: 13px; cursor: pointer; flex: 1; }
        .bar-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: 16px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 16px; transition: all 0.3s;
        }
        .bar-card:hover {
            transform: translateY(-4px); border-color: rgba(255, 107, 107, 0.3);
            box-shadow: 0 12px 24px rgba(255, 107, 107, 0.15);
        }
        .bar-name { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
        .bar-type { font-size: 13px; color: #ff8e8e; margin-bottom: 8px; }
        .bar-address { font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-bottom: 12px; }
        .bar-features { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .feature-badge {
            background: rgba(255, 107, 107, 0.15); color: #ff8e8e; padding: 4px 10px;
            border-radius: 6px; font-size: 11px; font-weight: 600;
        }
        .search-input {
            width: 100%; padding: 14px 16px; border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.05);
            color: white; font-size: 14px; margin-bottom: 20px;
        }
        .search-input:focus { outline: none; border-color: #ff8e8e; }
        .search-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .filters-search-section { margin-bottom: 20px; }
        .filters-search-section h3 { font-size: 16px; margin-bottom: 15px; color: #ff8e8e; }
        .search-filter-item {
            display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03); border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08); cursor: pointer; transition: all 0.2s;
            margin: 4px; font-size: 13px;
        }
        .search-filter-item:hover { background: rgba(255, 255, 255, 0.08); }
        .search-filter-item.active {
            background: rgba(255, 107, 107, 0.3); border-color: rgba(255, 107, 107, 0.5);
        }
        .notification {
            position: fixed; top: 20px; right: 20px; padding: 14px 20px;
            background: linear-gradient(135deg, #4ecca3, #3eb489); color: white;
            border-radius: 12px; font-weight: 600; box-shadow: 0 8px 20px rgba(78, 204, 163, 0.4);
            animation: slideIn 0.3s; z-index: 2000; max-width: 300px;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .btn-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-edit, .btn-delete {
            flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600;
            cursor: pointer; font-size: 13px;
        }
        .btn-edit { background: rgba(78, 204, 163, 0.2); color: #4ecca3; }
        .btn-delete { background: rgba(231, 76, 60, 0.2); color: #ff6b6b; }
        .empty-state { text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.4); }
        .selected-filters {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; min-height: 40px;
            padding: 12px; border-radius: 12px; background: rgba(255, 255, 255, 0.03);
        }
        .selected-filter-tag {
            display: flex; align-items: center; gap: 6px; padding: 6px 12px;
            background: rgba(255, 107, 107, 0.3); border-radius: 6px; font-size: 12px; font-weight: 600;
        }
        .filter-remove {
            background: none; border: none; color: white; cursor: pointer; font-size: 16px;
            line-height: 1; padding: 0; width: 16px; height: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SOIF</h1>
            <p>MyBarFinder - Montpellier (<span id="totalBars">96</span> bars)</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="fiche">üìù Fiche Bar</button>
            <button class="tab" data-tab="recherche">üîç Recherche</button>
        </div>

        <div id="fiche-content" class="content active">
            <button class="btn-primary" id="newBarBtn">+ Ajouter un nouveau bar</button>
            
            <div id="barFormContainer" style="display: none;">
                <h3 style="margin-bottom: 20px; font-size: 20px;">Informations du bar</h3>
                
                <div class="form-group">
                    <label class="form-label">Nom du bar *</label>
                    <input type="text" class="form-input" id="barName" placeholder="Ex: Le Rockstore">
                </div>
                <div class="form-group">
                    <label class="form-label">Type *</label>
                    <input type="text" class="form-input" id="barType" placeholder="Ex: Bar Rock">
                </div>
                <div class="form-group">
                    <label class="form-label">Adresse *</label>
                    <input type="text" class="form-input" id="barAddress" placeholder="Ex: 20 Rue de Verdun, 34000 Montpellier">
                </div>
                <div class="form-group">
                    <label class="form-label">Distance (km)</label>
                    <input type="number" step="0.1" class="form-input" id="barDistance" placeholder="0.5">
                </div>

                <div class="filters-section">
                    <h3 style="margin-bottom: 15px; font-size: 18px;">Caract√©ristiques</h3>
                    <div id="formFiltersContainer"></div>
                </div>

                <button class="btn-primary" id="saveBtn">Enregistrer le bar</button>
                <button class="btn-secondary" id="cancelBtn">Annuler</button>
            </div>

            <div id="barsList">
                <h3 style="margin-bottom: 15px; font-size: 18px;">Bars enregistr√©s (<span id="barsCount">96</span>)</h3>
                <div id="barsListContainer"></div>
            </div>
        </div>

        <div id="recherche-content" class="content">
            <input type="text" class="search-input" id="searchInput" placeholder="üîç Rechercher par nom ou utiliser + pour combiner des filtres">
            
            <button class="btn-primary" id="addFilterBtn">+ Ajouter un filtre</button>
            
            <div class="selected-filters" id="selectedFilters"></div>

            <div class="filters-search-section">
                <h3>Tous les filtres</h3>
                <div id="searchFiltersContainer"></div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px; font-size: 18px;">R√©sultats (<span id="resultCount">0</span>)</h3>
                <div id="searchResults"></div>
            </div>
        </div>
    </div>

    <script>
        const FILTERS = {
            caracteristiques: [
                {id:'terrasse',label:'‚òÄÔ∏è Terrasse'},{id:'wifi',label:'üì∂ WiFi'},{id:'happy_hour',label:'ü•Ç Happy Hour'},
                {id:'ouvert_maintenant',label:'‚úÖ Ouvert maintenant'},{id:'jeux',label:'üé≤ Jeux de soci√©t√©'},
                {id:'petanque',label:'üéØ P√©tanque'},{id:'billard',label:'üé± Billard'},{id:'tv',label:'üì∫ √âcrans TV'},
                {id:'clim',label:'‚ùÑÔ∏è Climatis√©'},{id:'chauffage',label:'üî• Chauffage ext√©rieur'},{id:'parking',label:'üÖøÔ∏è Parking'}
            ],
            acces_pmr: [
                {id:'plain_pied',label:'üö™ Acc√®s de plain-pied'},{id:'rampe',label:'üì∂ Rampe d\'acc√®s'},
                {id:'ascenseur',label:'üîº Ascenseur'},{id:'toilettes_pmr',label:'üöª Toilettes adapt√©es'},
                {id:'personnel_forme',label:'üë• Personnel form√©'},{id:'places_reservees',label:'ü™ë Places r√©serv√©es'}
            ],
            quartiers: [
                {id:'ecusson',label:'üõ°Ô∏è √âcusson'},{id:'antigone',label:'üèõÔ∏è Antigone'},{id:'comedie',label:'üé≠ Com√©die'},
                {id:'gare',label:'üöÇ Gare'},{id:'beaux_arts',label:'üé® Beaux-Arts'},{id:'port_marianne',label:'‚öì Port Marianne'},
                {id:'rives_lez',label:'üèûÔ∏è Rives du Lez'},{id:'hopitaux_fac',label:'üè´ H√¥pitaux-Facult√©s'},
                {id:'peyrou',label:'üè∞ Peyrou'},{id:'plage',label:'üèñÔ∏è Plage'}
            ],
            nourriture: [
                {id:'planches',label:'üßÄ Planches'},{id:'tapas',label:'ü•ò Tapas'},{id:'vegan',label:'üå± V√©gan'},
                {id:'vegetarien',label:'ü•¶ V√©g√©tarien'},{id:'gluten_free',label:'üåæ Sans gluten'},{id:'burgers',label:'üçî Burgers'},
                {id:'carte_complete',label:'üìã Carte compl√®te'},{id:'menus',label:'üìú Menus'},{id:'brunch',label:'ü•ê Brunch'}
            ],
            types: [
                {id:'bar_bieres',label:'üç∫ Bar √† bi√®res'},{id:'bar_vins',label:'üç∑ Bar √† vins'},
                {id:'bar_cocktails',label:'üç∏ Bar √† cocktails'},{id:'pub',label:'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø Pub'},
                {id:'brasserie',label:'üçª Brasserie'},{id:'cave_vin',label:'üçá Cave √† vin'},
                {id:'guinguette',label:'ü™ï Guinguette'},{id:'speakeasy',label:'ü§´ Speakeasy'},
                {id:'sport_tv',label:'‚öΩ Sports bar'},{id:'rooftop',label:'üèôÔ∏è Rooftop'},{id:'lounge',label:'üõãÔ∏è Lounge'}
            ],
            boissons: [
                {id:'cocktails_signature',label:'üç∏ Cocktails'},{id:'vins_naturels',label:'üç∑ Vins'},
                {id:'bieres_artisanales',label:'üç∫ Bi√®res'},{id:'craft',label:'üçª Craft'},
                {id:'whiskies',label:'ü•É Whiskies'},{id:'rhum',label:'üèùÔ∏è Rhums'},{id:'gins',label:'üåø Gins'},
                {id:'champagne',label:'üçæ Champagne'},{id:'sans_alcool',label:'üßÉ Sans alcool'},{id:'mocktails',label:'ü•§ Mocktails'}
            ],
            ensoleillement: [
                {id:'jamais',label:'üåë Jamais'},{id:'matin',label:'üåÖ Matin'},{id:'midi',label:'üåû Midi'},
                {id:'apres_midi',label:'üåá Apr√®s-midi'},{id:'soir',label:'üåÜ Soir'}
            ],
            clientele: [
                {id:'18_25',label:'üßë 18-25 ans'},{id:'25_35',label:'üë® 25-35 ans'},{id:'35_50',label:'üë© 35-50 ans'},
                {id:'50_plus',label:'üßì 50+ ans'},{id:'tous_ages',label:'üë™ Tous √¢ges'},
                {id:'etudiants',label:'üéì √âtudiants'},{id:'business',label:'üíº Business'}
            ],
            musiques: [
                {id:'rock',label:'üé∏ Rock'},{id:'pop',label:'üé§ Pop'},{id:'jazz',label:'üé∑ Jazz'},
                {id:'lounge_music',label:'üéπ Lounge'},{id:'electro',label:'üéß √âlectro'},{id:'techno',label:'üíø Techno'},
                {id:'hip_hop',label:'üéôÔ∏è Hip-Hop'},{id:'indie',label:'üéµ Indie'},{id:'classique',label:'üéª Classique'},
                {id:'variete',label:'üìª Vari√©t√©'},{id:'chanson_francaise',label:'üá´üá∑ Chanson fran√ßaise'}
            ],
            service: [
                {id:'chic',label:'‚ú® Chic'},{id:'familial',label:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familial'},{id:'decontracte',label:'üòé D√©contract√©'},
                {id:'amical',label:'ü§ù Amical'},{id:'rapide',label:'‚ö° Rapide'},{id:'attentionne',label:'ü§ó Attentionn√©'}
            ],
            evenements: [
                {id:'karaoke',label:'üé§ Karaok√©'},{id:'open_mic',label:'üé≠ Sc√®ne ouverte'},{id:'stand_up',label:'üé™ Stand-up'},
                {id:'dj_set',label:'üéß DJ Set'},{id:'concerts',label:'üéµ Concerts'},{id:'quiz',label:'‚ùì Quiz'},
                {id:'retransmissions',label:'üì∫ Retransmissions sport'},{id:'degustation',label:'üç∑ D√©gustations'},
                {id:'cours_cocktails',label:'üçπ Cours de cocktails'}
            ],
            parfait_pour: [
                {id:'couples',label:'‚ù§Ô∏è Couples'},{id:'famille_enfants',label:'üë®‚Äçüë©‚Äçüëß Famille avec enfants'},
                {id:'groupe_petit',label:'üë§ Groupe < 5'},{id:'groupe_moyen',label:'üë• Groupe 5-10'},
                {id:'groupe_grand',label:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Groupe > 10'},{id:'evenements_prives',label:'üéä √âv√©nements priv√©s'},
                {id:'afterwork',label:'üíº Afterwork'},{id:'anniversaire',label:'üéÇ Anniversaire'}
            ],
            assise: [
                {id:'canapes',label:'üõãÔ∏è Canap√©s'},{id:'bancs',label:'ü™ë Bancs'},{id:'mange_debout',label:'üßç Mange-debout'},
                {id:'tables',label:'üçΩÔ∏è Tables'},{id:'comptoir',label:'üßá Comptoir'},
                {id:'poufs',label:'üí∫ Poufs'},{id:'fauteuils',label:'ü™í Fauteuils'}
            ],
            ambiances: [
                {id:'cosy',label:'üõãÔ∏è Cosy'},{id:'tendance',label:'‚ú® Tendance'},{id:'afterwork_ambiance',label:'üíº Afterwork'},
                {id:'romantique',label:'‚ù§Ô∏è Romantique'},{id:'sport',label:'‚öΩ Sport'},{id:'festif',label:'üéâ Festif'},
                {id:'calme',label:'üßò Calme'},{id:'anime',label:'üíÉ Anim√©'},{id:'intime',label:'ü§´ Intime'}
            ]
        };
        const BARS_JSON = [
  {"id":1,"name":"Les 3 Singes","type":"Bar concert","address":"Rue des √É‚Ä∞tuves, 34000 Montpellier","distance":0.4,"features":["concerts","rock","ecusson","alternatif","festif"]},
  {"id":2,"name":"Le Alhambra Taberna","type":"Bar latino","address":"Rue Alexandre Cabanel, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","festif","ecusson","latino","dancefloor"]},
  {"id":3,"name":"L'Antirouille","type":"Bar concert / Club","address":"12 Rue Anatole-France, 34000 Montpellier","distance":0.8,"features":["indie","concerts","alternatif","ecusson","festif","rock"]},
  {"id":4,"name":"L'Arbre Blanc","type":"Bar rooftop","address":"Avenue Raymond Dugrand, 34000 Montpellier","distance":1.2,"features":["rooftop","vue_ville","chic","bar_cocktails","port_marianne"]},
  {"id":5,"name":"L'Australian Caf√É¬©","type":"Pub australien","address":"108 Rue de Rhodes, 34000 Montpellier","distance":1.3,"features":["pub","bar_bieres","ecusson","sport_tv"]},
  {"id":6,"name":"Un Bar et Jivay","type":"Bar √É¬† bi√É¬®re","address":"Square de la Babote, 34000 Montpellier","distance":0.6,"features":["bar_bieres","convivial","ecusson","decontracte","festif"]},
  {"id":7,"name":"Barberousse","type":"Pub pirate","address":"6 Rue Boussairolles, 34000 Montpellier","distance":0.4,"features":["rhum","festif","ecusson","pub","decoration_vintage","shots"]},
  {"id":8,"name":"La Barbote","type":"Bar microbrasserie","address":"1 Rue des Deux Ponts, 34000 Montpellier","distance":2.5,"features":["bar_bieres","terrasse_ensoleillee","jardin","calme","vue_ville"]},
  {"id":9,"name":"Le Barri","type":"Bar","address":"4 Boulevard Louis Blanc, 34000 Montpellier","distance":0.5,"features":["ecusson","convivial","bar_cocktails","terrasse"]},
  {"id":10,"name":"The Beehive","type":"Pub","address":"15 Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","convivial","terrasse"]},
  {"id":11,"name":"Le BelAmour","type":"Bar restaurant","address":"1 Rue Louis Lumi√É¬®re, 34970 Lattes","distance":3.5,"features":["lattes","terrasse","bar_vins","tapas","romantique"]},
  {"id":12,"name":"Le Berthom","type":"Bar √É¬† bi√É¬®res","address":"5 Rue Boussairolles, 34000 Montpellier","distance":0.1,"features":["bar_bieres","bieres_artisanales","ecusson","convivial","planches"]},
  {"id":13,"name":"Le Black Out","type":"Bar rock","address":"6 Rue de la Vieille Intendance, 34000 Montpellier","distance":0.6,"features":["rock","concerts","underground","ecusson","festif"]},
  {"id":14,"name":"The Black Sheep","type":"Pub alternatif","address":"21 Boulevard Louis Blanc, 34000 Montpellier","distance":1,"features":["concerts","bar_bieres","alternatif","beaux_arts","pub"]},
  {"id":15,"name":"Le Bockale","type":"Bar √É¬† bi√É¬®res","address":"2 Rue de la R√É¬©publique, 34000 Montpellier","distance":0.8,"features":["bar_bieres","bieres_artisanales","convivial","terrasse"]},
  {"id":16,"name":"Le Bonsoir","type":"Bar lounge","address":"6 Rue de la Croix d'Or, 34000 Montpellier","distance":0.4,"features":["lounge","bar_cocktails","ecusson","cosy","romantique"]},
  {"id":17,"name":"Le Boum Boum","type":"Bar dansant","address":"Lattes, 34970","distance":3.5,"features":["boite_club","dancefloor","festif","lattes","bar_cocktails"]},
  {"id":18,"name":"Le Broc Caf√É¬©","type":"Caf√É¬© bar","address":"Rue du Faubourg de N√É¬Æmes, 34000 Montpellier","distance":1.3,"features":["terrasse","happy_hour","ecusson","brasserie","cafe","convivial","calme"]},
  {"id":19,"name":"Le Burnoutbar","type":"Bar e-sport","address":"60 Bis Avenue du Pont Juv√É¬©nal, 34000 Montpellier","distance":1.8,"features":["jeux","bar_cocktails","antigone","convivial","jeux_societe"]},
  {"id":20,"name":"Caff√É¬® Panis","type":"Caf√É¬© brasserie","address":"3 Pl. du march√É¬© aux fleurs, 34000 Montpellier","distance":0.4,"features":["terrasse","ecusson","brasserie","cafe","decontracte","calme"]},
  {"id":21,"name":"Caf√É¬© de la panac√É¬©e","type":"Caf√É¬© restaurant","address":"14 rue de l'√É¬©cole de Pharmacie, 34000 Montpellier","distance":0.3,"features":["terrasse","happy_hour","ecusson","brasserie","decontracte","convivial","dj_set","cosy","calme"]},
  {"id":22,"name":"Le Caf√É¬© Joseph","type":"Brasserie","address":"Place Jean Jaur√É¬®s, 34000 Montpellier","distance":0.3,"features":["terrasse","bar_cocktails","ecusson","brasserie"]},
  {"id":23,"name":"Le Caf√É¬© Joyeux","type":"Caf√É¬© solidaire","address":"Place Alexandre Laissac, 34000 Montpellier","distance":0.1,"features":["cafe","terrasse","convivial"]},
  {"id":24,"name":"Le Caf√É¬© Jules","type":"Brasserie","address":"2 Place de la Com√É¬©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","cafe","brasserie"]},
  {"id":25,"name":"Le Caf√É¬© Latitude","type":"Caf√É¬© culturel","address":"Rue de la M√É¬©diterran√É¬©e, 34000 Montpellier","distance":1.5,"features":["cafe","concerts","terrasse","convivial","alternatif"]},
  {"id":26,"name":"Le Caf√É¬© Paume","type":"Caf√É¬© bar","address":"Boulevard du Jeu de Paume, 34000 Montpellier","distance":0.3,"features":["cafe","terrasse","ecusson","calme","wifi"]},
  {"id":27,"name":"Caf√É¬© Pitot","type":"Caf√É¬© bar","address":"2 Place d'Aviler, 34000 Montpellier","distance":1.2,"features":["cafe","terrasse","calme","cosy","wifi"]},
  {"id":28,"name":"Le Caf√É¬© Riche","type":"Brasserie historique","address":"8 Place de la Com√É¬©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","cafe","brasserie"]},
  {"id":29,"name":"Chez Canaille","type":"Bar restaurant","address":"5 Place du Petit Scel, 34000 Montpellier","distance":0.3,"features":["bar_vins","tapas","terrasse","convivial","cosy"]},
  {"id":30,"name":"Le Carolan's","type":"Pub irlandais","address":"Place Saint-C√É¬¥me, 34000 Montpellier","distance":0.2,"features":["pub","bar_bieres","comedie","sport_tv","convivial"]},
  {"id":31,"name":"La Casa Cubana","type":"Bar latino","address":"2 Place de la Chapelle, 34000 Montpellier","distance":0.6,"features":["bar_cocktails","latino","dancefloor","ecusson","festif"]},
  {"id":32,"name":"La Chistera","type":"Pub","address":"2 Bis Rue d'Obilion, 34000 Montpellier","distance":0.1,"features":["bar_bieres","bieres_artisanales","pub","comedie","convivial","karaoke"]},
  {"id":33,"name":"La Cigale","type":"Bar brasserie","address":"7 Boulevard des Arceaux, 34000 Montpellier","distance":0.6,"features":["brasserie","terrasse","comedie","cafe","vue_ville"]},
  {"id":34,"name":"Le Clandestin","type":"Bar speakeasy","address":"18 Rue de la Valfr√É¬®re, 34000 Montpellier","distance":0.3,"features":["speakeasy","bar_cocktails","ecusson","chic","cosy"]},
  {"id":35,"name":"Le Comptoir de l'Arc","type":"Caf√É¬© bar","address":"1 Place Lacanourgue, 34000 Montpellier","distance":0.9,"features":["terrasse","ecusson","cafe","vue_ville","calme"]},
  {"id":36,"name":"The Copperbar","type":"Pub moderne","address":"6 Rue de l'Universit√É¬©, 34000 Montpellier","distance":0.6,"features":["spiritueux","cosy","ecusson","pub","chic"]},
  {"id":37,"name":"Les Coulisses","type":"Bar lounge","address":"3-9 Rue Cop√É¬© Cambes, 34000 Montpellier","distance":0.3,"features":["lounge","bar_cocktails","ecusson","cosy","chic"]},
  {"id":38,"name":"Le Coyot Bar","type":"Bar am√É¬©ricain","address":"1348 Avenue de la Mer Raymond Dugrand, 34000 Montpellier","distance":1.5,"features":["bar_cocktails","terrasse","port_marianne","festif","burgers"]},
  {"id":39,"name":"Le Cubanito","type":"Bar latino","address":"13 Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["latino","bar_cocktails","ecusson","festif","dancefloor"]},
  {"id":40,"name":"Le Discopathe","type":"Bar disco","address":"28 Rue du Faubourg du Courreau, 34000 Montpellier","distance":0.9,"features":["disco","dancefloor","festif","dj_set","figuerolles"]},
  {"id":41,"name":"La Distillerie","type":"Bar √É¬† cocktails","address":"67 Rue de l'Aiguillerie, 34000 Montpellier","distance":0.6,"features":["bar_cocktails","cocktails_signature","speakeasy","ecusson","chic"]},
  {"id":42,"name":"Le Drapeau Rouge","type":"Bar alternatif","address":"53 Rue du Faubourg Boutonnet, 34000 Montpellier","distance":1.3,"features":["alternatif","concerts","boutonnet","underground","convivial"]},
  {"id":43,"name":"La Dune","type":"Club","address":"Palavas-les-Flots, 34250","distance":12,"features":["boite_club","plage","terrasse_ensoleillee","vue_mer","festif","cocktails_signature"]},
  {"id":44,"name":"Le D√É¬¥me","type":"Bar √É¬©l√É¬©gant","address":"2 Rue du Grand Saint-Jean, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","ecusson","lounge","chic"]},
  {"id":45,"name":"Les Enfants Rouges","type":"Bar restaurant","address":"3 Plan Duch√É¬©, 34000 Montpellier","distance":0.5,"features":["ecusson","bar_cocktails","tapas","terrasse","branche"]},
  {"id":46,"name":"Le Fitzpatrick's","type":"Pub irlandais","address":"9 Place Saint-C√É¬¥me, 34000 Montpellier","distance":0.2,"features":["sport_tv","bar_bieres","convivial","comedie","pub"]},
  {"id":47,"name":"Le Fizz","type":"Club","address":"Rue de Verdun, 34000 Montpellier","distance":0.9,"features":["boite_club","dancefloor","dj_set","electro","festif"]},
  {"id":48,"name":"La Fumerie","type":"Bar lounge","address":"Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.5,"features":["lounge","bar_cocktails","ecusson","cosy","chic"]},
  {"id":49,"name":"Les Gar√É¬ßons","type":"Bar","address":"15 Rue des S√Ö‚Äúurs Noires, 34000 Montpellier","distance":0.6,"features":["ecusson","convivial","bar_cocktails","decontracte","festif"]},
  {"id":50,"name":"Le Gazette Caf√É¬©","type":"Caf√É¬© culturel","address":"6 Rue Levat, 34000 Montpellier","distance":1.1,"features":["terrasse","gare","brasserie","cafe","convivial","concerts","cosy"]},
  {"id":51,"name":"Le Harts Bar","type":"Pub","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},
  {"id":52,"name":"Le Hopulus Brewpub","type":"Brasserie artisanale","address":"8 Rue Collot, 34000 Montpellier","distance":0.1,"features":["brasserie","bieres_artisanales","comedie","planches","snacking"]},
  {"id":53,"name":"Hossegor Bar","type":"Bar","address":"8 Rue de la Petite Loge, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","festif","disco","comedie","decontracte"]},
  {"id":54,"name":"The Invader","type":"Bar geek","address":"5 Rue du Plan d'Agde, 34000 Montpellier","distance":0.5,"features":["jeux","bar_cocktails","ecusson","convivial","alternatif"]},
  {"id":55,"name":"La Jalade","type":"Bar nature","address":"10 Rue de la Jalade, 34000 Montpellier","distance":2,"features":["calme","terrasse_ombragee","jardin","cosy","decontracte"]},
  {"id":56,"name":"Le Jost","type":"Bar lounge","address":"8 Rue du Faubourg de la Saunerie, 34000 Montpellier","distance":0.7,"features":["bar_cocktails","cosy","figuerolles","lounge","tendance"]},
  {"id":57,"name":"Le Kaleido Bar","type":"Bar √É¬† cocktails","address":"2 Rue Jules Latreilhe, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","terrasse","comedie","cafe","tapas","dj_set"]},
  {"id":58,"name":"Le Kiosque Verde Paradis","type":"Bar nature","address":"Quartier Beaux-Arts, 34000 Montpellier","distance":1,"features":["jardin","terrasse_ensoleillee","calme","bar_vins","beaux_arts"]},
  {"id":59,"name":"Madrediosa","type":"Bar lgbtqia+","address":"5 rue Belmont, 34000 Montpellier","distance":0.3,"features":["terrasse","happy_hour","beaux_arts","bar_bieres","bar_cocktails","decontracte","convivial","karaoke","dj_set","festif","cosy"]},
  {"id":60,"name":"La Maison Fleurie","type":"Bar √É¬† cocktails","address":"Rue du Faubourg Figuerolles, 34000 Montpellier","distance":1.4,"features":["bar_cocktails","jardin","terrasse_ombragee","calme","cosy"]},
  {"id":61,"name":"Les Marchands","type":"Bar √É¬† vin","address":"8 Place Alexandre Laissac, 34000 Montpellier","distance":0.5,"features":["bar_vins","ecusson","cosy","planches","vins_naturels"]},
  {"id":62,"name":"Le Mas de Couran","type":"Restaurant","address":"Chemin de Soriech, 34970 Lattes","distance":4.0,"features":["boite_club","dancefloor","festif","dj_set","lattes","plage","terrasse_ensoleillee","brasserie","bar_cocktails"]},
  {"id":63,"name":"Mas du Cheval","type":"Bar","address":"Avenue de l'Agau, 34970 Lattes","distance":3.5,"features":["boite_club","dancefloor","tapas","festif","dj_set","lattes","bar_cocktails"]},
  {"id":64,"name":"Le Mas du Roux","type":"Bar","address":"Lattes, 34970","distance":3.5,"features":["boite_club","dancefloor","festif","lattes","bar_cocktails"]},
  {"id":65,"name":"Mi Barrio","type":"Bar latino","address":"Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["latino","bar_cocktails","ecusson","festif","tapas"]},
  {"id":66,"name":"Le Milk Club","type":"Club","address":"Rue Ferdinand Fabre, 34000 Montpellier","distance":1,"features":["boite_club","dancefloor","dj_set","festif","electro"]},
  {"id":67,"name":"Le Mio Bar","type":"Bar √É¬† cocktails","address":"11 Rue des Balances, 34000 Montpellier","distance":0.4,"features":["bar_cocktails","gin","cocktails_signature","lounge","terrasse"]},
  {"id":68,"name":"Le Miranov","type":"Rooftop","address":"455 Avenue du Professeur Antonin Balm√É¬®s, 34000 Montpellier","distance":2.5,"features":["rooftop","calme","cosy","snacking","convivial"]},
  {"id":69,"name":"Le Moom","type":"Bar dansant","address":"Lattes, 34970","distance":3.5,"features":["boite_club","dancefloor","festif","lattes","bar_cocktails"]},
  {"id":70,"name":"Le Mosquito","type":"Bar latino","address":"1 Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["bar_cocktails","latino","dancefloor","ecusson","festif","dj_set"]},
  {"id":71,"name":"La Muchacha","type":"Bar latino","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["latino","bar_cocktails","ecusson","festif","convivial"]},
  {"id":72,"name":"Le Mustang","type":"Bar am√É¬©ricain","address":"Rue du Grand Saint-Jean, 34000 Montpellier","distance":0.4,"features":["ecusson","bar_cocktails","festif","rock","convivial"]},
  {"id":73,"name":"La Notte","type":"Bar √É¬† vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","vins_naturels","ecusson","cosy","planches"]},
  {"id":74,"name":"Le Novelty","type":"Bar","address":"Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["bar_cocktails","festif","convivial","ecusson"]},
  {"id":75,"name":"Le O'Sullivan","type":"Pub irlandais","address":"Boulevard du Jeu de Paume, 34000 Montpellier","distance":0.3,"features":["pub","bar_bieres","sport_tv","comedie","festif"]},
  {"id":76,"name":"Le Panama","type":"Night Club","address":"Rue de la R√É¬©publique, 34000 Montpellier","distance":0.5,"features":["boite_club","dancefloor","dj_set","chic","festif"]},
  {"id":77,"name":"Le Palace","type":"Bar √É¬† pastis","address":"Montpellier, 34000","distance":0.5,"features":["bar_cocktails","terrasse","pizzas","sport_tv","babyfoot","flechettes"]},
  {"id":78,"name":"La Pampa Sauvage","type":"Bar","address":"2400 Route de P√É¬©rols, 34970 Lattes","distance":5,"features":["bar_cocktails","snacking","disco","terrasse_ensoleillee","vue_ville"]},
  {"id":79,"name":"Le Club","type":"Night club","address":" 5 Rue du Grand Saint-Jean, 34000 Montpellier","distance":0.3,"features":["boite_club","cocktails_signature","chic","ecusson","speakeasy","cosy"]},
  {"id":80,"name":"Le Parfum","type":"Bar √É¬† cocktails","address":"55 Rue de la Cavalerie, 34000 Montpellier","distance":1,"features":["bar_cocktails","cocktails_signature","cosy","chic","romantique"]},
  {"id":81,"name":"The Peacock","type":"Pub anglais","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},
  {"id":82,"name":"Plein Sud","type":"Bar restaurant","address":"Port Marianne, 34000 Montpellier","distance":2,"features":["terrasse_ensoleillee","bar_cocktails","port_marianne","vue_ville","brunch"]},
  {"id":83,"name":"Popular Brewing","type":"Brewpub","address":"14 rue Pila Saint Gely, 34000 Montpellier","distance":0.2,"features":["terrasse","jeux","ecusson","bar_bieres","rock","indie","convivial","cosy","decontracte"]},
  {"id":84,"name":"Pousse Pas M√É¬©m√É¬©e Dans La Vigne","type":"Bar √É¬† vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","ecusson","convivial"]},
  {"id":85,"name":"Le Rebuffy","type":"Bar chill","address":"3 Rue Rebuffy, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","terrasse","ecusson","calme","cosy","decontracte"]},
  {"id":86,"name":"Le Redline","type":"Bar com√É¬©die club","address":"5 rue des Teissiers, 34000 Montpellier","distance":0.8,"features":["rock","concerts","underground","festif","metal"]},
  {"id":87,"name":"Le Rhum Runner","type":"Bar √É¬† rhum","address":"Rue des Tr√É¬©soriers de France, 34000 Montpellier","distance":0.4,"features":["rhum","bar_cocktails","ecusson","festif","tropical"]},
  {"id":88,"name":"Le Rockstore","type":"Bar Rock / Concert","address":"20 Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["concerts","rock","underground","ecusson","festif","metal"]},
  {"id":89,"name":"Le R√É¬©servoir","type":"Bar √É¬† bi√É¬®res","address":"55 Rue de Montels Saint-Pierre, 34070 Montpellier","distance":2,"features":["bar_bieres","quiz","karaoke"]},
  {"id":90,"name":"Le Saint Roch","type":"Bar","address":"Quartier Saint-Roch, 34000 Montpellier","distance":0.6,"features":["convivial","bar_bieres","terrasse","decontracte"]},
  {"id":91,"name":"Le Secco","type":"Bar √É¬† vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","vins_naturels","ecusson","cosy","planches","brunch","festif"]},
  {"id":92,"name":"The Shakespeare","type":"Pub anglais","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["bieres_artisanales","pub","ecusson","terrasse","wifi","convivial"]},
  {"id":93,"name":"Le Smash Bar","type":"Bar √É¬† cocktails","address":"Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.5,"features":["bar_cocktails","cocktails_signature","ecusson","festif","tendance"]},
  {"id":94,"name":"Le St Roch","type":"Bar √É¬† tapas","address":"22 Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.4,"features":["bar_vins","tapas","ecusson","convivial","cosy"]},
  {"id":95,"name":"Les Super Vedettes","type":"Bar concert","address":"4 Place des Beaux-Arts, 34000 Montpellier","distance":1,"features":["concerts","indie","alternatif","rock","festif","sport_tv","terrasse_ombragee"]},
  {"id":96,"name":"Le Tarbrew","type":"Bar √É¬† bi√É¬®res","address":"20 Rue du Docteur Pezat, 34000 Montpellier","distance":1.3,"features":["bar_bieres","bieres_artisanales","bieres_locales","terrasse","figuerolles","convivial","flechettes"]},
  {"id":97,"name":"La Terraza","type":"Bar terrasse","address":"Place de la Com√É¬©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","bar_cocktails","vue_ville","festif"]},
  {"id":98,"name":"Le Times","type":"Pub","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},
  {"id":99,"name":"Le Toit Toit Mon Toit","type":"Rooftop bar","address":"Antigone, 34000 Montpellier","distance":1.5,"features":["rooftop","vue_ville","terrasse_ensoleillee","bar_cocktails","chic"]},
  {"id":100,"name":"Le Trinque Fougasse","type":"Bar √É¬† vin","address":"1 Rue de la Gal√É¬©ra, 34000 Montpellier","distance":1.2,"features":["bar_vins","tapas","terrasse_ensoleillee","port_marianne","vins_naturels","planches"]},
  {"id":101,"name":"Le Triskell","type":"Bar breton","address":"Place Candolle, 34000 Montpellier","distance":0.5,"features":["terrasse","ecusson","bar_bieres","cafe","rock","convivial","cosy","calme"]},
  {"id":102,"name":"Le Tub","type":"Bar √É¬† cocktails","address":"6 Rue du Petit Scel, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","chic","electro"]},
  {"id":103,"name":"Le V&B","type":"Bar √É¬† bi√É¬®res","address":"9 All√É¬©e du Levant, 34970 Lattes","distance":4,"features":["bar_bieres","bieres_artisanales","planches","convivial"]},
  {"id":104,"name":"Le Verre √É¬† Soi","type":"Bar √É¬† vin","address":"17 Rue Saint-Guilhem, 34000 Montpellier","distance":0.6,"features":["bar_vins","ecusson","cosy"]},
  {"id":105,"name":"Le VR √É¬† Vin","type":"Bar √É¬† vin","address":"468 Rue de la Croix Verte, 34090 Montpellier","distance":2.8,"features":["bar_vins","boutonnet","cosy"]},
  {"id":106,"name":"Le Z√®bre Bleu","type":"Bar musical","address":"Lieu‚Äëdit La Calade, Route de Palavas, 34970 Lattes","distance":3.5,"features":["boite_club","dancefloor","festif","dj_set","lattes","brasserie","bar_cocktails","concerts"]}
]
        let bars = [];
        let editingBarId = null;
        let selectedSearchFilters = [];

        function removeArticle(name) {
            const articles = ['Le ', 'La ', 'Les ', 'L\'', 'The ', 'Chez '];
            for (let article of articles) {
                if (name.startsWith(article)) {
                    return name.substring(article.length);
                }
            }
            return name;
        }

        function sortBarsByName(barsArray) {
            return barsArray.sort((a, b) => {
                const nameA = removeArticle(a.name).toLowerCase();
                const nameB = removeArticle(b.name).toLowerCase();
                return nameA.localeCompare(nameB);
            });
        }

        function loadBars() {
            const saved = localStorage.getItem('soif_bars');
            bars = saved ? JSON.parse(saved) : [...BARS_JSON];
            bars = sortBarsByName(bars);
            updateCounts();
        }

        function saveBars() {
            localStorage.setItem('soif_bars', JSON.stringify(bars));
        }

        function findFilterLabel(filterId) {
            for (const category in FILTERS) {
                const filter = FILTERS[category].find(f => f.id === filterId);
                if (filter) return filter.label;
            }
            return filterId;
        }

        function generateFormFilters() {
            const container = document.getElementById('formFiltersContainer');
            Object.keys(FILTERS).forEach(categoryKey => {
                const div = document.createElement('div');
                div.className = 'category';
                
                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = categoryKey.replace(/_/g, ' ').toUpperCase();
                div.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'filter-grid';
                
                FILTERS[categoryKey].forEach(filter => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    item.dataset.filterId = filter.id;
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `form_${filter.id}`;
                    checkbox.value = filter.id;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `form_${filter.id}`;
                    label.textContent = filter.label;
                    
                    item.appendChild(checkbox);
                    item.appendChild(label);
                    
                    item.addEventListener('click', function(e) {
                        if (e.target.tagName !== 'INPUT') {
                            checkbox.checked = !checkbox.checked;
                        }
                        this.classList.toggle('active', checkbox.checked);
                    });
                    
                    grid.appendChild(item);
                });
                
                div.appendChild(grid);
                container.appendChild(div);
            });
        }

        function generateSearchFilters() {
            const container = document.getElementById('searchFiltersContainer');
            Object.keys(FILTERS).forEach(categoryKey => {
                const div = document.createElement('div');
                div.className = 'category';
                
                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = categoryKey.replace(/_/g, ' ').toUpperCase();
                div.appendChild(title);
                
                const filtersDiv = document.createElement('div');
                filtersDiv.style.marginTop = '10px';
                
                FILTERS[categoryKey].forEach(filter => {
                    const item = document.createElement('div');
                    item.className = 'search-filter-item';
                    item.dataset.filterId = filter.id;
                    item.textContent = filter.label;
                    
                    item.addEventListener('click', function() {
                        toggleSearchFilter(filter.id);
                    });
                    
                    filtersDiv.appendChild(item);
                });
                
                div.appendChild(filtersDiv);
                container.appendChild(div);
            });
        }

        function toggleSearchFilter(filterId) {
            const index = selectedSearchFilters.indexOf(filterId);
            if (index > -1) {
                selectedSearchFilters.splice(index, 1);
            } else {
                selectedSearchFilters.push(filterId);
            }
            updateSearchFilterUI();
            updateSelectedFilters();
            performSearch();
        }

        function updateSearchFilterUI() {
            document.querySelectorAll('.search-filter-item').forEach(item => {
                const isActive = selectedSearchFilters.includes(item.dataset.filterId);
                item.classList.toggle('active', isActive);
            });
        }

        function updateSelectedFilters() {
            const container = document.getElementById('selectedFilters');
            container.innerHTML = '';
            
            if (selectedSearchFilters.length === 0) {
                container.innerHTML = '<span style="color: rgba(255,255,255,0.4); font-size: 13px;">Aucun filtre s√©lectionn√©</span>';
                return;
            }
            
            selectedSearchFilters.forEach(filterId => {
                const tag = document.createElement('div');
                tag.className = 'selected-filter-tag';
                
                const label = document.createElement('span');
                label.textContent = findFilterLabel(filterId);
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'filter-remove';
                removeBtn.textContent = '√ó';
                removeBtn.addEventListener('click', () => toggleSearchFilter(filterId));
                
                tag.appendChild(label);
                tag.appendChild(removeBtn);
                container.appendChild(tag);
            });
        }

        function performSearch() {
            const searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
            let filtered = bars;
            
            if (searchQuery) {
                filtered = filtered.filter(bar => 
                    bar.name.toLowerCase().includes(searchQuery) ||
                    bar.type.toLowerCase().includes(searchQuery) ||
                    bar.address.toLowerCase().includes(searchQuery)
                );
            }
            
            if (selectedSearchFilters.length > 0) {
                filtered = filtered.filter(bar =>
                    selectedSearchFilters.every(filterId => bar.features.includes(filterId))
                );
            }
            
            renderSearchResults(filtered);
        }

        function renderSearchResults(filteredBars) {
            const container = document.getElementById('searchResults');
            const countEl = document.getElementById('resultCount');
            countEl.textContent = filteredBars.length;
            
            if (filteredBars.length === 0) {
                container.innerHTML = '<div class="empty-state">Aucun bar trouv√©</div>';
                return;
            }
            
            container.innerHTML = '';
            filteredBars.forEach(bar => {
                const card = createBarCard(bar, false);
                container.appendChild(card);
            });
        }

        function createBarCard(bar, withActions = false) {
            const card = document.createElement('div');
            card.className = 'bar-card';
            
            const name = document.createElement('div');
            name.className = 'bar-name';
            name.textContent = bar.name;
            
            const type = document.createElement('div');
            type.className = 'bar-type';
            type.textContent = bar.type;
            
            const address = document.createElement('div');
            address.className = 'bar-address';
            address.textContent = `${bar.address} ‚Ä¢ ${bar.distance} km`;
            
            const features = document.createElement('div');
            features.className = 'bar-features';
            bar.features.slice(0, 8).forEach(f => {
                const badge = document.createElement('span');
                badge.className = 'feature-badge';
                badge.textContent = findFilterLabel(f);
                features.appendChild(badge);
            });
            if (bar.features.length > 8) {
                const more = document.createElement('span');
                more.className = 'feature-badge';
                more.textContent = `+${bar.features.length - 8}`;
                features.appendChild(more);
            }
            
            card.appendChild(name);
            card.appendChild(type);
            card.appendChild(address);
            card.appendChild(features);
            
            if (withActions) {
                const actions = document.createElement('div');
                actions.className = 'btn-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn-edit';
                editBtn.textContent = '‚úèÔ∏è Modifier';
                editBtn.addEventListener('click', () => editBar(bar.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete';
                deleteBtn.textContent = 'üóëÔ∏è Supprimer';
                deleteBtn.addEventListener('click', () => deleteBar(bar.id));
                
                actions.appendChild(editBtn);
                actions.appendChild(deleteBtn);
                card.appendChild(actions);
            }
            
            return card;
        }

        function renderBarsList() {
            const container = document.getElementById('barsListContainer');
            container.innerHTML = '';
            
            if (bars.length === 0) {
                container.innerHTML = '<div class="empty-state">Aucun bar enregistr√©</div>';
                return;
            }
            
            bars.forEach(bar => {
                const card = createBarCard(bar, true);
                container.appendChild(card);
            });
        }

        function showNewBarForm() {
            editingBarId = null;
            document.getElementById('barFormContainer').style.display = 'block';
            document.getElementById('barsList').style.display = 'none';
            clearForm();
        }

        function cancelEdit() {
            document.getElementById('barFormContainer').style.display = 'none';
            document.getElementById('barsList').style.display = 'block';
            clearForm();
        }

        function clearForm() {
            document.getElementById('barName').value = '';
            document.getElementById('barType').value = '';
            document.getElementById('barAddress').value = '';
            document.getElementById('barDistance').value = '';
            
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('#formFiltersContainer .filter-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        function editBar(id) {
            const bar = bars.find(b => b.id === id);
            if (!bar) return;
            
            editingBarId = id;
            document.getElementById('barFormContainer').style.display = 'block';
            document.getElementById('barsList').style.display = 'none';
            
            document.getElementById('barName').value = bar.name;
            document.getElementById('barType').value = bar.type;
            document.getElementById('barAddress').value = bar.address;
            document.getElementById('barDistance').value = bar.distance;
            
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]').forEach(cb => {
                const isChecked = bar.features.includes(cb.value);
                cb.checked = isChecked;
                cb.closest('.filter-item').classList.toggle('active', isChecked);
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveBar() {
            const name = document.getElementById('barName').value.trim();
            const type = document.getElementById('barType').value.trim();
            const address = document.getElementById('barAddress').value.trim();
            const distance = parseFloat(document.getElementById('barDistance').value) || 0;
            
            if (!name || !type || !address) {
                showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const features = [];
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]:checked').forEach(cb => {
                features.push(cb.value);
            });
            
            if (editingBarId) {
                const index = bars.findIndex(b => b.id === editingBarId);
                if (index !== -1) {
                    bars[index] = { ...bars[index], name, type, address, distance, features };
                    showNotification('‚úÖ Bar modifi√© !');
                }
            } else {
                const id = bars.length > 0 ? Math.max(...bars.map(b => b.id)) + 1 : 1;
                bars.push({ id, name, type, address, distance, features });
                showNotification('‚úÖ Bar cr√©√© !');
            }
            
            bars = sortBarsByName(bars);
            saveBars();
            cancelEdit();
            renderBarsList();
            updateCounts();
        }

        function deleteBar(id) {
            const bar = bars.find(b => b.id === id);
            if (!bar) return;
            
            if (!confirm(`Supprimer "${bar.name}" ?`)) return;
            
            bars = bars.filter(b => b.id !== id);
            saveBars();
            showNotification('üóëÔ∏è Bar supprim√©');
            renderBarsList();
            updateCounts();
        }

        function updateCounts() {
            const count = bars.length;
            document.getElementById('totalBars').textContent = count;
            document.getElementById('barsCount').textContent = count;
        }

        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            if (type === 'error') {
                notif.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            }
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => {
                if (notif.parentNode) notif.remove();
            }, 3000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            if (tabName === 'recherche') {
                performSearch();
            }
        }

        function scrollToFilters() {
            const filtersSection = document.getElementById('searchFiltersContainer');
            filtersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function init() {
            loadBars();
            generateFormFilters();
            generateSearchFilters();
            renderBarsList();
            updateSelectedFilters();
            performSearch();
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            document.getElementById('newBarBtn').addEventListener('click', showNewBarForm);
            document.getElementById('saveBtn').addEventListener('click', saveBar);
            document.getElementById('cancelBtn').addEventListener('click', cancelEdit);
            document.getElementById('addFilterBtn').addEventListener('click', scrollToFilters);
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                const value = searchInput.value.trim();
                if (value.includes('+')) {
                    const parts = value.split('+').map(p => p.trim().toLowerCase()).filter(p => p);
                    parts.forEach(part => {
                        for (const category in FILTERS) {
                            const filter = FILTERS[category].find(f => 
                                f.label.toLowerCase().includes(part) || f.id.toLowerCase().includes(part)
                            );
                            if (filter && !selectedSearchFilters.includes(filter.id)) {
                                selectedSearchFilters.push(filter.id);
                            }
                        }
                    });
                    searchInput.value = '';
                    updateSearchFilterUI();
                    updateSelectedFilters();
                }
                performSearch();
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
