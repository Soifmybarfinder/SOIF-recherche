<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOIF MyBarFinder - Montpellier</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a0f24 0%, #2d1b3d 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 500px; margin: 0 auto; background: #1a0f24; min-height: 100vh; }
        .header {
            background: linear-gradient(135deg, #4a0e4e 0%, #81236e 40%, #ab2567 70%, #ff006e 100%);
            padding: 40px 24px 30px;
            text-align: center;
        }
        .header h1 { font-size: 48px; font-weight: 200; letter-spacing: 12px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .tabs {
            display: flex;
            background: #21152f;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab {
            flex: 1; padding: 16px; text-align: center; background: transparent; border: none;
            color: rgba(255, 255, 255, 0.5); font-weight: 600; cursor: pointer; font-size: 14px;
            transition: all 0.3s; position: relative;
        }
        .tab.active { color: #fff; }
        .tab.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
        }
        .content { padding: 24px; display: none; }
        .content.active { display: block; }
        .btn-primary {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 16px;
            cursor: pointer; margin-bottom: 16px; transition: transform 0.2s;
        }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary {
            width: 100%; padding: 16px; background: rgba(255,255,255,0.1); color: white;
            border: none; border-radius: 12px; font-weight: 700; font-size: 16px;
            cursor: pointer; margin-top: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        .form-input {
            width: 100%; padding: 12px 16px; border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.05);
            color: white; font-size: 14px;
        }
        .form-input:focus { outline: none; border-color: #ff8e8e; }
        .form-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .category { margin-bottom: 25px; }
        .category-title {
            font-weight: 700; font-size: 15px; margin-bottom: 12px; color: #ff8e8e;
            padding: 8px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .filter-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .filter-item {
            display: flex; align-items: center; gap: 8px; padding: 10px;
            background: rgba(255, 255, 255, 0.03); border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08); cursor: pointer; transition: all 0.2s;
        }
        .filter-item:hover { background: rgba(255, 255, 255, 0.08); }
        .filter-item.active {
            background: rgba(255, 107, 107, 0.3); border-color: rgba(255, 107, 107, 0.5);
        }
        .filter-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; display: none; }
        .filter-item label { font-size: 13px; cursor: pointer; flex: 1; }
        .bar-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: 16px; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 16px; transition: all 0.3s;
        }
        .bar-card:hover {
            transform: translateY(-4px); border-color: rgba(255, 107, 107, 0.3);
            box-shadow: 0 12px 24px rgba(255, 107, 107, 0.15);
        }
        .bar-name { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
        .bar-type { font-size: 13px; color: #ff8e8e; margin-bottom: 8px; }
        .bar-address { font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-bottom: 12px; }
        .bar-features { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
        .feature-badge {
            background: rgba(255, 107, 107, 0.15); color: #ff8e8e; padding: 4px 10px;
            border-radius: 6px; font-size: 11px; font-weight: 600;
        }
        .search-input {
            width: 100%; padding: 14px 16px; border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.05);
            color: white; font-size: 14px; margin-bottom: 20px;
        }
        .search-input:focus { outline: none; border-color: #ff8e8e; }
        .search-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .filters-search-section { margin-bottom: 20px; }
        .filters-search-section h3 { font-size: 16px; margin-bottom: 15px; color: #ff8e8e; }
        .search-filter-item {
            display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03); border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08); cursor: pointer; transition: all 0.2s;
            margin: 4px; font-size: 13px;
        }
        .search-filter-item:hover { background: rgba(255, 255, 255, 0.08); }
        .search-filter-item.active {
            background: rgba(255, 107, 107, 0.3); border-color: rgba(255, 107, 107, 0.5);
        }
        .notification {
            position: fixed; top: 20px; right: 20px; padding: 14px 20px;
            background: linear-gradient(135deg, #4ecca3, #3eb489); color: white;
            border-radius: 12px; font-weight: 600; box-shadow: 0 8px 20px rgba(78, 204, 163, 0.4);
            animation: slideIn 0.3s; z-index: 2000; max-width: 300px;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .btn-actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-edit, .btn-delete {
            flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600;
            cursor: pointer; font-size: 13px;
        }
        .btn-edit { background: rgba(78, 204, 163, 0.2); color: #4ecca3; }
        .btn-delete { background: rgba(231, 76, 60, 0.2); color: #ff6b6b; }
        .empty-state { text-align: center; padding: 60px 20px; color: rgba(255, 255, 255, 0.4); }
        .selected-filters {
            display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; min-height: 40px;
            padding: 12px; border-radius: 12px; background: rgba(255, 255, 255, 0.03);
        }
        .selected-filter-tag {
            display: flex; align-items: center; gap: 6px; padding: 6px 12px;
            background: rgba(255, 107, 107, 0.3); border-radius: 6px; font-size: 12px; font-weight: 600;
        }
        .filter-remove {
            background: none; border: none; color: white; cursor: pointer; font-size: 16px;
            line-height: 1; padding: 0; width: 16px; height: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SOIF</h1>
            <p>MyBarFinder - Montpellier (<span id="totalBars">96</span> bars)</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="fiche">ğŸ“ Fiche Bar</button>
            <button class="tab" data-tab="recherche">ğŸ” Recherche</button>
        </div>

        <div id="fiche-content" class="content active">
            <button class="btn-primary" id="newBarBtn">+ Ajouter un nouveau bar</button>
            
            <div id="barFormContainer" style="display: none;">
                <h3 style="margin-bottom: 20px; font-size: 20px;">Informations du bar</h3>
                
                <div class="form-group">
                    <label class="form-label">Nom du bar *</label>
                    <input type="text" class="form-input" id="barName" placeholder="Ex: Le Rockstore">
                </div>
                <div class="form-group">
                    <label class="form-label">Type *</label>
                    <input type="text" class="form-input" id="barType" placeholder="Ex: Bar Rock">
                </div>
                <div class="form-group">
                    <label class="form-label">Adresse *</label>
                    <input type="text" class="form-input" id="barAddress" placeholder="Ex: 20 Rue de Verdun, 34000 Montpellier">
                </div>
                <div class="form-group">
                    <label class="form-label">Distance (km)</label>
                    <input type="number" step="0.1" class="form-input" id="barDistance" placeholder="0.5">
                </div>

                <div class="filters-section">
                    <h3 style="margin-bottom: 15px; font-size: 18px;">CaractÃ©ristiques</h3>
                    <div id="formFiltersContainer"></div>
                </div>

                <button class="btn-primary" id="saveBtn">Enregistrer le bar</button>
                <button class="btn-secondary" id="cancelBtn">Annuler</button>
            </div>

            <div id="barsList">
                <h3 style="margin-bottom: 15px; font-size: 18px;">Bars enregistrÃ©s (<span id="barsCount">96</span>)</h3>
                <div id="barsListContainer"></div>
            </div>
        </div>

        <div id="recherche-content" class="content">
            <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Rechercher par nom ou utiliser + pour combiner des filtres">
            
            <button class="btn-primary" id="addFilterBtn">+ Ajouter un filtre</button>
            
            <div class="selected-filters" id="selectedFilters"></div>

            <div class="filters-search-section">
                <h3>Tous les filtres</h3>
                <div id="searchFiltersContainer"></div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px; font-size: 18px;">RÃ©sultats (<span id="resultCount">0</span>)</h3>
                <div id="searchResults"></div>
            </div>
        </div>
    </div>

    <script>
        const FILTERS = {
            caracteristiques: [
                {id:'terrasse',label:'â˜€ï¸ Terrasse'},{id:'wifi',label:'ğŸ“¶ WiFi'},{id:'happy_hour',label:'ğŸ¥‚ Happy Hour'},
                {id:'ouvert_maintenant',label:'âœ… Ouvert maintenant'},{id:'jeux',label:'ğŸ² Jeux de sociÃ©tÃ©'},
                {id:'petanque',label:'ğŸ¯ PÃ©tanque'},{id:'billard',label:'ğŸ± Billard'},{id:'tv',label:'ğŸ“º Ã‰crans TV'},
                {id:'clim',label:'â„ï¸ ClimatisÃ©'},{id:'chauffage',label:'ğŸ”¥ Chauffage extÃ©rieur'},{id:'parking',label:'ğŸ…¿ï¸ Parking'}
            ],
            acces_pmr: [
                {id:'plain_pied',label:'ğŸšª AccÃ¨s de plain-pied'},{id:'rampe',label:'ğŸ“¶ Rampe d\'accÃ¨s'},
                {id:'ascenseur',label:'ğŸ”¼ Ascenseur'},{id:'toilettes_pmr',label:'ğŸš» Toilettes adaptÃ©es'},
                {id:'personnel_forme',label:'ğŸ‘¥ Personnel formÃ©'},{id:'places_reservees',label:'ğŸª‘ Places rÃ©servÃ©es'}
            ],
            quartiers: [
                {id:'ecusson',label:'ğŸ›¡ï¸ Ã‰cusson'},{id:'antigone',label:'ğŸ›ï¸ Antigone'},{id:'comedie',label:'ğŸ­ ComÃ©die'},
                {id:'gare',label:'ğŸš‚ Gare'},{id:'beaux_arts',label:'ğŸ¨ Beaux-Arts'},{id:'port_marianne',label:'âš“ Port Marianne'},
                {id:'rives_lez',label:'ğŸï¸ Rives du Lez'},{id:'hopitaux_fac',label:'ğŸ« HÃ´pitaux-FacultÃ©s'},
                {id:'peyrou',label:'ğŸ° Peyrou'},{id:'plage',label:'ğŸ–ï¸ Plage'}
            ],
            nourriture: [
                {id:'planches',label:'ğŸ§€ Planches'},{id:'tapas',label:'ğŸ¥˜ Tapas'},{id:'vegan',label:'ğŸŒ± VÃ©gan'},
                {id:'vegetarien',label:'ğŸ¥¦ VÃ©gÃ©tarien'},{id:'gluten_free',label:'ğŸŒ¾ Sans gluten'},{id:'burgers',label:'ğŸ” Burgers'},
                {id:'carte_complete',label:'ğŸ“‹ Carte complÃ¨te'},{id:'menus',label:'ğŸ“œ Menus'},{id:'brunch',label:'ğŸ¥ Brunch'}
            ],
            types: [
                {id:'bar_bieres',label:'ğŸº Bar Ã  biÃ¨res'},{id:'bar_vins',label:'ğŸ· Bar Ã  vins'},
                {id:'bar_cocktails',label:'ğŸ¸ Bar Ã  cocktails'},{id:'pub',label:'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Pub'},
                {id:'brasserie',label:'ğŸ» Brasserie'},{id:'cave_vin',label:'ğŸ‡ Cave Ã  vin'},
                {id:'guinguette',label:'ğŸª• Guinguette'},{id:'speakeasy',label:'ğŸ¤« Speakeasy'},
                {id:'sport_tv',label:'âš½ Sports bar'},{id:'rooftop',label:'ğŸ™ï¸ Rooftop'},{id:'lounge',label:'ğŸ›‹ï¸ Lounge'}
            ],
            boissons: [
                {id:'cocktails_signature',label:'ğŸ¸ Cocktails'},{id:'vins_naturels',label:'ğŸ· Vins'},
                {id:'bieres_artisanales',label:'ğŸº BiÃ¨res'},{id:'craft',label:'ğŸ» Craft'},
                {id:'whiskies',label:'ğŸ¥ƒ Whiskies'},{id:'rhum',label:'ğŸï¸ Rhums'},{id:'gins',label:'ğŸŒ¿ Gins'},
                {id:'champagne',label:'ğŸ¾ Champagne'},{id:'sans_alcool',label:'ğŸ§ƒ Sans alcool'},{id:'mocktails',label:'ğŸ¥¤ Mocktails'}
            ],
            ensoleillement: [
                {id:'jamais',label:'ğŸŒ‘ Jamais'},{id:'matin',label:'ğŸŒ… Matin'},{id:'midi',label:'ğŸŒ Midi'},
                {id:'apres_midi',label:'ğŸŒ‡ AprÃ¨s-midi'},{id:'soir',label:'ğŸŒ† Soir'}
            ],
            clientele: [
                {id:'18_25',label:'ğŸ§‘ 18-25 ans'},{id:'25_35',label:'ğŸ‘¨ 25-35 ans'},{id:'35_50',label:'ğŸ‘© 35-50 ans'},
                {id:'50_plus',label:'ğŸ§“ 50+ ans'},{id:'tous_ages',label:'ğŸ‘ª Tous Ã¢ges'},
                {id:'etudiants',label:'ğŸ“ Ã‰tudiants'},{id:'business',label:'ğŸ’¼ Business'}
            ],
            musiques: [
                {id:'rock',label:'ğŸ¸ Rock'},{id:'pop',label:'ğŸ¤ Pop'},{id:'jazz',label:'ğŸ· Jazz'},
                {id:'lounge_music',label:'ğŸ¹ Lounge'},{id:'electro',label:'ğŸ§ Ã‰lectro'},{id:'techno',label:'ğŸ’¿ Techno'},
                {id:'hip_hop',label:'ğŸ™ï¸ Hip-Hop'},{id:'indie',label:'ğŸµ Indie'},{id:'classique',label:'ğŸ» Classique'},
                {id:'variete',label:'ğŸ“» VariÃ©tÃ©'},{id:'chanson_francaise',label:'ğŸ‡«ğŸ‡· Chanson franÃ§aise'}
            ],
            service: [
                {id:'chic',label:'âœ¨ Chic'},{id:'familial',label:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familial'},{id:'decontracte',label:'ğŸ˜ DÃ©contractÃ©'},
                {id:'amical',label:'ğŸ¤ Amical'},{id:'rapide',label:'âš¡ Rapide'},{id:'attentionne',label:'ğŸ¤— AttentionnÃ©'}
            ],
            evenements: [
                {id:'karaoke',label:'ğŸ¤ KaraokÃ©'},{id:'open_mic',label:'ğŸ­ ScÃ¨ne ouverte'},{id:'stand_up',label:'ğŸª Stand-up'},
                {id:'dj_set',label:'ğŸ§ DJ Set'},{id:'concerts',label:'ğŸµ Concerts'},{id:'quiz',label:'â“ Quiz'},
                {id:'retransmissions',label:'ğŸ“º Retransmissions sport'},{id:'degustation',label:'ğŸ· DÃ©gustations'},
                {id:'cours_cocktails',label:'ğŸ¹ Cours de cocktails'}
            ],
            parfait_pour: [
                {id:'couples',label:'â¤ï¸ Couples'},{id:'famille_enfants',label:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Famille avec enfants'},
                {id:'groupe_petit',label:'ğŸ‘¤ Groupe < 5'},{id:'groupe_moyen',label:'ğŸ‘¥ Groupe 5-10'},
                {id:'groupe_grand',label:'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Groupe > 10'},{id:'evenements_prives',label:'ğŸŠ Ã‰vÃ©nements privÃ©s'},
                {id:'afterwork',label:'ğŸ’¼ Afterwork'},{id:'anniversaire',label:'ğŸ‚ Anniversaire'}
            ],
            assise: [
                {id:'canapes',label:'ğŸ›‹ï¸ CanapÃ©s'},{id:'bancs',label:'ğŸª‘ Bancs'},{id:'mange_debout',label:'ğŸ§ Mange-debout'},
                {id:'tables',label:'ğŸ½ï¸ Tables'},{id:'comptoir',label:'ğŸ§‡ Comptoir'},
                {id:'poufs',label:'ğŸ’º Poufs'},{id:'fauteuils',label:'ğŸª’ Fauteuils'}
            ],
            ambiances: [
                {id:'cosy',label:'ğŸ›‹ï¸ Cosy'},{id:'tendance',label:'âœ¨ Tendance'},{id:'afterwork_ambiance',label:'ğŸ’¼ Afterwork'},
                {id:'romantique',label:'â¤ï¸ Romantique'},{id:'sport',label:'âš½ Sport'},{id:'festif',label:'ğŸ‰ Festif'},
                {id:'calme',label:'ğŸ§˜ Calme'},{id:'anime',label:'ğŸ’ƒ AnimÃ©'},{id:'intime',label:'ğŸ¤« Intime'}
            ]
        };

        const BARS_JSON = [{"id":1,"name":"L'Antirouille","type":"Bar Concert","address":"12 Rue Anatole-France, 34000 Montpellier","distance":0.8,"features":["indie","concerts","alternatif","ecusson","festif","rock"]},{"id":2,"name":"L'Arbre Blanc","type":"Bar rooftop","address":"Avenue Raymond Dugrand, 34000 Montpellier","distance":1.2,"features":["rooftop","vue_ville","chic","bar_cocktails","port_marianne"]},{"id":3,"name":"L'Australian CafÃ©","type":"Pub australien","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["pub","bar_bieres","ecusson","sport_tv","brunch"]},{"id":4,"name":"La Barbote","type":"Bar guinguette","address":"Bords du Lez, 34000 Montpellier","distance":2.5,"features":["guinguette","terrasse_ensoleillee","jardin","calme","vue_ville"]},{"id":5,"name":"Barberousse","type":"Pub pirate","address":"6 Rue Boussairolles, 34000 Montpellier","distance":0.4,"features":["rhum","festif","ecusson","pub","decoration_vintage","shots"]},{"id":6,"name":"Le Bar des GarÃ§ons","type":"Bar","address":"Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.6,"features":["ecusson","convivial","bar_cocktails","decontracte","festif"]},{"id":7,"name":"Le Bar des Marchands","type":"Bar Ã  vin","address":"Rue des Marchands, 34000 Montpellier","distance":0.5,"features":["bar_vins","ecusson","cosy","planches","vins_naturels"]},{"id":8,"name":"Le Barri","type":"Bar","address":"Centre-ville, 34000 Montpellier","distance":0.5,"features":["ecusson","convivial","bar_cocktails","terrasse"]},{"id":9,"name":"The Beehive","type":"Pub","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","convivial","terrasse"]},{"id":10,"name":"Le Bel Amour","type":"Bar restaurant","address":"Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["ecusson","terrasse","bar_vins","tapas","romantique"]},{"id":11,"name":"Le Berthom","type":"Bar Ã  biÃ¨res","address":"Rue de la Carbonnerie, 34000 Montpellier","distance":0.5,"features":["bar_bieres","bieres_artisanales","ecusson","convivial","planches"]},{"id":12,"name":"The Black Sheep","type":"Pub alternatif","address":"21 Boulevard Louis Blanc, 34000 Montpellier","distance":1.0,"features":["concerts","bar_bieres","alternatif","beaux_arts","pub"]},{"id":13,"name":"Le Black Out","type":"Bar rock","address":"6 Rue de la Vieille Intendance, 34000 Montpellier","distance":0.6,"features":["rock","concerts","underground","ecusson","festif"]},{"id":14,"name":"Le Bockale","type":"Bar Ã  biÃ¨res","address":"Rue du Faubourg de NÃ®mes, 34000 Montpellier","distance":1.2,"features":["bar_bieres","bieres_artisanales","convivial","terrasse"]},{"id":15,"name":"Le Bonsoir","type":"Bar lounge","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["lounge","bar_cocktails","ecusson","cosy","romantique"]},{"id":16,"name":"Le Bouchon St Roch","type":"Bar Ã  tapas","address":"10 Rue des Ã‰tuves, 34000 Montpellier","distance":0.4,"features":["bar_vins","tapas","ecusson","convivial","cosy"]},{"id":17,"name":"Le Broc CafÃ©","type":"CafÃ© bar","address":"Rue du Faubourg de NÃ®mes, 34000 Montpellier","distance":1.3,"features":["cafe","terrasse","convivial","brunch","calme"]},{"id":18,"name":"Le CafÃ© de l'Arc","type":"CafÃ© bar","address":"1 Place de l'Arc de Triomphe, 34000 Montpellier","distance":0.9,"features":["terrasse","ecusson","cafe","vue_ville","calme"]},{"id":19,"name":"Le CafÃ© Joseph","type":"Brasserie","address":"Place Jean JaurÃ¨s, 34000 Montpellier","distance":0.3,"features":["terrasse","bar_cocktails","ecusson","branche","brasserie"]},{"id":20,"name":"Le CafÃ© Joyeux","type":"CafÃ© solidaire","address":"Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["cafe","terrasse","comedie","convivial","brunch"]},{"id":21,"name":"Le CafÃ© Jules","type":"Brasserie","address":"2 Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","cafe","branche","vue_ville","brasserie"]},{"id":22,"name":"Le CafÃ© Latitude","type":"CafÃ© culturel","address":"Rue de la MÃ©diterranÃ©e, 34000 Montpellier","distance":1.5,"features":["cafe","concerts","terrasse","convivial","alternatif"]},{"id":23,"name":"Le CafÃ© Panis","type":"CafÃ© brasserie","address":"Boulevard du Jeu de Paume, 34000 Montpellier","distance":0.4,"features":["cafe","brasserie","terrasse","comedie","brunch"]},{"id":24,"name":"CafÃ© Pitot","type":"CafÃ© bar","address":"Rue du Faubourg de NÃ®mes, 34000 Montpellier","distance":1.2,"features":["cafe","terrasse","calme","cosy","wifi"]},{"id":25,"name":"Le CafÃ© Paume","type":"CafÃ© bar","address":"Boulevard du Jeu de Paume, 34000 Montpellier","distance":0.3,"features":["cafe","terrasse","ecusson","calme","wifi"]},{"id":26,"name":"Le CafÃ© Riche","type":"Brasserie historique","address":"8 Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","cafe","decoration_vintage","brasserie"]},{"id":27,"name":"Chez Canaille","type":"Bar restaurant","address":"Rue du Faubourg de NÃ®mes, 34000 Montpellier","distance":1.2,"features":["bar_vins","tapas","terrasse","convivial","cosy"]},{"id":28,"name":"La Cigale","type":"Bar brasserie","address":"Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["brasserie","terrasse","comedie","cafe","vue_ville"]},{"id":30,"name":"Le Clandestin","type":"Bar speakeasy","address":"Rue du Petit Scel, 34000 Montpellier","distance":0.3,"features":["speakeasy","bar_cocktails","ecusson","chic","cosy"]},{"id":31,"name":"The Copperbar","type":"Pub moderne","address":"6 Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.6,"features":["spiritueux","cosy","ecusson","pub","chic"]},{"id":32,"name":"Les Coulisses","type":"Bar lounge","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["lounge","bar_cocktails","ecusson","cosy","chic"]},{"id":33,"name":"Le Coyotte Bar","type":"Bar amÃ©ricain","address":"Place Jean JaurÃ¨s, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","terrasse","ecusson","festif","burgers"]},{"id":34,"name":"Le Cubanito","type":"Bar latino","address":"Rue des TrÃ©soriers de France, 34000 Montpellier","distance":0.4,"features":["latino","bar_cocktails","ecusson","festif","dancefloor"]},{"id":35,"name":"Le DÃ©lirium CafÃ©","type":"Bar Ã  biÃ¨res belges","address":"1 Rue du Faubourg du Courreau, 34000 Montpellier","distance":0.9,"features":["bar_bieres","bieres_artisanales","festif","figuerolles","convivial"]},{"id":36,"name":"Le Discopathe","type":"Bar disco","address":"Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.7,"features":["disco","dancefloor","festif","dj_set","ecusson"]},{"id":37,"name":"La Distillerie","type":"Bar Ã  cocktails","address":"6 Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.6,"features":["bar_cocktails","cocktails_signature","speakeasy","ecusson","chic"]},{"id":38,"name":"Le DÃ´me","type":"Bar Ã©lÃ©gant","address":"2 Rue du Grand Saint-Jean, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","ecusson","lounge","chic","tendance"]},{"id":39,"name":"Le Drapeau Rouge","type":"Bar alternatif","address":"Rue du Faubourg Figuerolles, 34000 Montpellier","distance":1.3,"features":["alternatif","concerts","figuerolles","underground","convivial"]},{"id":40,"name":"La Dune","type":"Bar de plage","address":"Palavas-les-Flots, 34250","distance":12.0,"features":["plage","terrasse_ensoleillee","vue_mer","festif","cocktails_signature"]},{"id":41,"name":"Les Enfants Rouges","type":"Bar restaurant","address":"Rue de la Carbonnerie, 34000 Montpellier","distance":0.5,"features":["ecusson","bar_cocktails","tapas","terrasse","branche"]},{"id":42,"name":"Le Fitzpatrick's","type":"Pub irlandais","address":"9 Place Saint-CÃ´me, 34000 Montpellier","distance":0.2,"features":["sport_tv","bar_bieres","convivial","comedie","pub"]},{"id":43,"name":"Le Fizz","type":"Club","address":"Rue de Verdun, 34000 Montpellier","distance":0.9,"features":["boite_club","dancefloor","dj_set","electro","festif"]},{"id":44,"name":"La Fumerie","type":"Bar lounge","address":"Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.5,"features":["lounge","bar_cocktails","ecusson","cosy","chic"]},{"id":45,"name":"Le Gazette CafÃ©","type":"CafÃ© culturel","address":"6 Rue Levat, 34000 Montpellier","distance":1.1,"features":["concerts","terrasse","cafe","convivial"]},{"id":46,"name":"Le Harts Bar","type":"Pub","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},{"id":47,"name":"Le Hopulus Brewpub","type":"Brasserie artisanale","address":"Rue du Faubourg Figuerolles, 34000 Montpellier","distance":1.4,"features":["brasserie","bieres_artisanales","figuerolles","terrasse","burgers"]},{"id":48,"name":"The Invader","type":"Bar geek","address":"5 Rue du Plan d'Agde, 34000 Montpellier","distance":0.5,"features":["jeux","bar_cocktails","ecusson","convivial","alternatif"]},{"id":49,"name":"La Jalade","type":"Bar nature","address":"10 Rue de la Jalade, 34000 Montpellier","distance":2.0,"features":["calme","terrasse_ombragee","jardin","cosy","decontracte"]},{"id":50,"name":"Le Jivay","type":"Bar Ã©tudiant","address":"5 Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.6,"features":["bar_bieres","convivial","ecusson","decontracte","festif"]},{"id":51,"name":"Le Jost","type":"Bar lounge","address":"8 Rue du Faubourg de la Saunerie, 34000 Montpellier","distance":0.7,"features":["bar_cocktails","cosy","figuerolles","lounge","tendance"]},{"id":52,"name":"Le Kiosque Verde Paradis","type":"Bar nature","address":"Quartier Beaux-Arts, 34000 Montpellier","distance":1.0,"features":["jardin","terrasse_ombragee","calme","bar_vins","beaux_arts"]},{"id":53,"name":"Le Madrediosa","type":"Bar latino","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["latino","bar_cocktails","ecusson","festif","dancefloor"]},{"id":54,"name":"La Maison Fleurie","type":"Bar jardin","address":"Rue du Faubourg Figuerolles, 34000 Montpellier","distance":1.4,"features":["jardin","terrasse_ombragee","calme","bar_vins","cosy"]},{"id":55,"name":"Le Meltdown","type":"Bar e-sport","address":"20 Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["jeux","bar_cocktails","ecusson","convivial","jeux_societe"]},{"id":56,"name":"Mi Barrio","type":"Bar latino","address":"Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["latino","bar_cocktails","ecusson","festif","tapas"]},{"id":57,"name":"Le Milk","type":"Club","address":"Avenue de la Mer, 34000 Montpellier","distance":1.5,"features":["boite_club","dancefloor","dj_set","techno","festif"]},{"id":58,"name":"Le Milk Club","type":"Club","address":"Rue Ferdinand Fabre, 34000 Montpellier","distance":1.0,"features":["boite_club","dancefloor","dj_set","festif","electro"]},{"id":59,"name":"Le Miranov","type":"Bar Ã©tudiant","address":"14 Rue du Faubourg Boutonnet, 34000 Montpellier","distance":1.3,"features":["bar_bieres","calme","cosy","decontracte","convivial"]},{"id":60,"name":"Le Mojito Bar","type":"Bar latino","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","festif","ecusson","latino","dancefloor"]},{"id":61,"name":"Le Mojito Club","type":"Bar latino","address":"3 Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.6,"features":["bar_cocktails","latino","dancefloor","ecusson","festif"]},{"id":62,"name":"Le Montpel","type":"Brasserie","address":"Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["brasserie","terrasse","comedie","cafe","vue_ville"]},{"id":63,"name":"Le Mosquito","type":"Bar latino","address":"1 Rue du Plan d'Agde, 34000 Montpellier","distance":0.4,"features":["bar_cocktails","latino","dancefloor","ecusson","festif","dj_set"]},{"id":64,"name":"La Muchacha","type":"Bar latino","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["latino","bar_cocktails","ecusson","festif","convivial"]},{"id":65,"name":"Le Mustang","type":"Bar amÃ©ricain","address":"Rue du Grand Saint-Jean, 34000 Montpellier","distance":0.4,"features":["ecusson","bar_cocktails","festif","rock","convivial"]},{"id":66,"name":"La NottÃ©e","type":"Bar Ã  vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","vins_naturels","ecusson","cosy","planches"]},{"id":67,"name":"Le Novelty","type":"Club","address":"Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["boite_club","dancefloor","dj_set","electro","festif"]},{"id":68,"name":"Le O'Carolans","type":"Pub irlandais","address":"Place Saint-CÃ´me, 34000 Montpellier","distance":0.2,"features":["pub","bar_bieres","comedie","sport_tv","convivial"]},{"id":69,"name":"Le O'Sullivan","type":"Pub irlandais","address":"Boulevard du Jeu de Paume, 34000 Montpellier","distance":0.3,"features":["pub","bar_bieres","sport_tv","comedie","festif"]},{"id":70,"name":"Le Palace","type":"Club","address":"Rue de la RÃ©publique, 34000 Montpellier","distance":0.5,"features":["boite_club","dancefloor","dj_set","chic","festif"]},{"id":71,"name":"Papa Doble","type":"Bar Ã  cocktails","address":"6 Rue du Petit Scel, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","cocktails_signature","chic","ecusson","speakeasy","cosy"]},{"id":72,"name":"Le Parfum","type":"Bar Ã  cocktails","address":"55 Rue de la Cavalerie, 34000 Montpellier","distance":1.0,"features":["bar_cocktails","cocktails_signature","cosy","chic","romantique"]},{"id":73,"name":"The Peacock","type":"Pub anglais","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},{"id":74,"name":"Plein Sud","type":"Bar restaurant","address":"Port Marianne, 34000 Montpellier","distance":2.0,"features":["terrasse_ensoleillee","bar_cocktails","port_marianne","vue_ville","brunch"]},{"id":75,"name":"Pousse Pas MÃ©mÃ©e Dans La Vigne","type":"Bar Ã  vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","vins_naturels","ecusson","convivial","planches"]},{"id":76,"name":"Le Rebuffy","type":"Bar chill","address":"3 Rue Rebuffy, 34000 Montpellier","distance":0.3,"features":["bar_cocktails","terrasse","ecusson","calme","cosy","decontracte"]},{"id":77,"name":"Le Redline","type":"Bar rock","address":"Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["rock","concerts","underground","festif","metal"]},{"id":78,"name":"Le Rhum Runner","type":"Bar Ã  rhum","address":"Rue des TrÃ©soriers de France, 34000 Montpellier","distance":0.4,"features":["rhum","bar_cocktails","ecusson","festif","tropical"]},{"id":79,"name":"Le Rockstore","type":"Bar Rock / Concert","address":"20 Rue de Verdun, 34000 Montpellier","distance":0.8,"features":["concerts","rock","underground","ecusson","festif","metal"]},{"id":80,"name":"Le Saint Roch","type":"Bar de quartier","address":"Quartier Saint-Roch, 34000 Montpellier","distance":0.6,"features":["convivial","bar_bieres","terrasse","decontracte"]},{"id":81,"name":"Le Secco","type":"Bar Ã  vin","address":"Rue de l'Aiguillerie, 34000 Montpellier","distance":0.5,"features":["bar_vins","vins_naturels","ecusson","cosy","planches"]},{"id":82,"name":"The Shakespeare","type":"Pub anglais","address":"Rue de la Merci, 34000 Montpellier","distance":0.4,"features":["bieres_artisanales","pub","ecusson","terrasse","wifi","convivial"]},{"id":83,"name":"Les 3 Singes","type":"Bar concert","address":"Rue des Ã‰tuves, 34000 Montpellier","distance":0.4,"features":["concerts","rock","ecusson","alternatif","festif"]},{"id":84,"name":"Le Smash Bar","type":"Bar Ã  cocktails","address":"Rue du Petit Saint-Jean, 34000 Montpellier","distance":0.5,"features":["bar_cocktails","cocktails_signature","ecusson","festif","tendance"]},{"id":85,"name":"Les Super Vedettes","type":"Bar concert","address":"Rue des BattiÃ¨res, 34000 Montpellier","distance":1.8,"features":["concerts","indie","alternatif","rock","festif"]},{"id":86,"name":"Le Tarbrew","type":"Bar Ã  biÃ¨res","address":"22 Rue du Faubourg Figuerolles, 34000 Montpellier","distance":1.5,"features":["bar_bieres","bieres_artisanales","terrasse","figuerolles","convivial"]},{"id":87,"name":"La Terraza","type":"Bar terrasse","address":"Place de la ComÃ©die, 34000 Montpellier","distance":0.1,"features":["terrasse","comedie","bar_cocktails","vue_ville","festif"]},{"id":88,"name":"Le Times","type":"Pub","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["pub","bar_bieres","ecusson","sport_tv","convivial"]},{"id":89,"name":"Le Toit Toit Mon Toit","type":"Rooftop bar","address":"Antigone, 34000 Montpellier","distance":1.5,"features":["rooftop","vue_ville","terrasse_ensoleillee","bar_cocktails","chic"]},{"id":90,"name":"Le Trinque Fougasse","type":"Bar Ã  vin","address":"1 Rue de la GalÃ©ra, 34000 Montpellier","distance":1.2,"features":["bar_vins","tapas","terrasse_ensoleillee","port_marianne","vins_naturels","planches"]},{"id":91,"name":"Le Trinque Fougasse O'Sud","type":"Bar Ã  vin","address":"148 Rue de la GalÃ©ra, 34000 Montpellier","distance":2.5,"features":["bar_vins","concerts","terrasse_ensoleillee","port_marianne","vins_naturels"]},{"id":92,"name":"Le Triskel","type":"Bar breton","address":"11 Rue des TrÃ©soriers de la Bourse, 34000 Montpellier","distance":0.5,"features":["bar_bieres","festif","ecusson","convivial"]},{"id":93,"name":"Le Tub","type":"Bar club","address":"Centre-ville, 34000 Montpellier","distance":0.6,"features":["boite_club","dancefloor","dj_set","festif","electro"]},{"id":94,"name":"Le V&B","type":"Bar Ã  biÃ¨res","address":"Rue de la Loge, 34000 Montpellier","distance":0.3,"features":["bar_bieres","bieres_artisanales","ecusson","planches","convivial"]},{"id":95,"name":"Le Verre Ã  Soi","type":"Bar Ã  vin","address":"Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.6,"features":["bar_vins","vins_naturels","ecusson","cosy","planches"]},{"id":96,"name":"Le VR Ã  Vin","type":"Bar Ã  vin","address":"Rue de l'UniversitÃ©, 34000 Montpellier","distance":0.6,"features":["bar_vins","vins_naturels","ecusson","cosy","planches"]}];

        let bars = [];
        let editingBarId = null;
        let selectedSearchFilters = [];

        function removeArticle(name) {
            const articles = ['Le ', 'La ', 'Les ', 'L\'', 'The ', 'Chez '];
            for (let article of articles) {
                if (name.startsWith(article)) {
                    return name.substring(article.length);
                }
            }
            return name;
        }

        function sortBarsByName(barsArray) {
            return barsArray.sort((a, b) => {
                const nameA = removeArticle(a.name).toLowerCase();
                const nameB = removeArticle(b.name).toLowerCase();
                return nameA.localeCompare(nameB);
            });
        }

        function loadBars() {
            const saved = localStorage.getItem('soif_bars');
            bars = saved ? JSON.parse(saved) : [...BARS_JSON];
            bars = sortBarsByName(bars);
            updateCounts();
        }

        function saveBars() {
            localStorage.setItem('soif_bars', JSON.stringify(bars));
        }

        function findFilterLabel(filterId) {
            for (const category in FILTERS) {
                const filter = FILTERS[category].find(f => f.id === filterId);
                if (filter) return filter.label;
            }
            return filterId;
        }

        function generateFormFilters() {
            const container = document.getElementById('formFiltersContainer');
            Object.keys(FILTERS).forEach(categoryKey => {
                const div = document.createElement('div');
                div.className = 'category';
                
                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = categoryKey.replace(/_/g, ' ').toUpperCase();
                div.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'filter-grid';
                
                FILTERS[categoryKey].forEach(filter => {
                    const item = document.createElement('div');
                    item.className = 'filter-item';
                    item.dataset.filterId = filter.id;
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `form_${filter.id}`;
                    checkbox.value = filter.id;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `form_${filter.id}`;
                    label.textContent = filter.label;
                    
                    item.appendChild(checkbox);
                    item.appendChild(label);
                    
                    item.addEventListener('click', function(e) {
                        if (e.target.tagName !== 'INPUT') {
                            checkbox.checked = !checkbox.checked;
                        }
                        this.classList.toggle('active', checkbox.checked);
                    });
                    
                    grid.appendChild(item);
                });
                
                div.appendChild(grid);
                container.appendChild(div);
            });
        }

        function generateSearchFilters() {
            const container = document.getElementById('searchFiltersContainer');
            Object.keys(FILTERS).forEach(categoryKey => {
                const div = document.createElement('div');
                div.className = 'category';
                
                const title = document.createElement('div');
                title.className = 'category-title';
                title.textContent = categoryKey.replace(/_/g, ' ').toUpperCase();
                div.appendChild(title);
                
                const filtersDiv = document.createElement('div');
                filtersDiv.style.marginTop = '10px';
                
                FILTERS[categoryKey].forEach(filter => {
                    const item = document.createElement('div');
                    item.className = 'search-filter-item';
                    item.dataset.filterId = filter.id;
                    item.textContent = filter.label;
                    
                    item.addEventListener('click', function() {
                        toggleSearchFilter(filter.id);
                    });
                    
                    filtersDiv.appendChild(item);
                });
                
                div.appendChild(filtersDiv);
                container.appendChild(div);
            });
        }

        function toggleSearchFilter(filterId) {
            const index = selectedSearchFilters.indexOf(filterId);
            if (index > -1) {
                selectedSearchFilters.splice(index, 1);
            } else {
                selectedSearchFilters.push(filterId);
            }
            updateSearchFilterUI();
            updateSelectedFilters();
            performSearch();
        }

        function updateSearchFilterUI() {
            document.querySelectorAll('.search-filter-item').forEach(item => {
                const isActive = selectedSearchFilters.includes(item.dataset.filterId);
                item.classList.toggle('active', isActive);
            });
        }

        function updateSelectedFilters() {
            const container = document.getElementById('selectedFilters');
            container.innerHTML = '';
            
            if (selectedSearchFilters.length === 0) {
                container.innerHTML = '<span style="color: rgba(255,255,255,0.4); font-size: 13px;">Aucun filtre sÃ©lectionnÃ©</span>';
                return;
            }
            
            selectedSearchFilters.forEach(filterId => {
                const tag = document.createElement('div');
                tag.className = 'selected-filter-tag';
                
                const label = document.createElement('span');
                label.textContent = findFilterLabel(filterId);
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'filter-remove';
                removeBtn.textContent = 'Ã—';
                removeBtn.addEventListener('click', () => toggleSearchFilter(filterId));
                
                tag.appendChild(label);
                tag.appendChild(removeBtn);
                container.appendChild(tag);
            });
        }

        function performSearch() {
            const searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
            let filtered = bars;
            
            if (searchQuery) {
                filtered = filtered.filter(bar => 
                    bar.name.toLowerCase().includes(searchQuery) ||
                    bar.type.toLowerCase().includes(searchQuery) ||
                    bar.address.toLowerCase().includes(searchQuery)
                );
            }
            
            if (selectedSearchFilters.length > 0) {
                filtered = filtered.filter(bar =>
                    selectedSearchFilters.every(filterId => bar.features.includes(filterId))
                );
            }
            
            renderSearchResults(filtered);
        }

        function renderSearchResults(filteredBars) {
            const container = document.getElementById('searchResults');
            const countEl = document.getElementById('resultCount');
            countEl.textContent = filteredBars.length;
            
            if (filteredBars.length === 0) {
                container.innerHTML = '<div class="empty-state">Aucun bar trouvÃ©</div>';
                return;
            }
            
            container.innerHTML = '';
            filteredBars.forEach(bar => {
                const card = createBarCard(bar, false);
                container.appendChild(card);
            });
        }

        function createBarCard(bar, withActions = false) {
            const card = document.createElement('div');
            card.className = 'bar-card';
            
            const name = document.createElement('div');
            name.className = 'bar-name';
            name.textContent = bar.name;
            
            const type = document.createElement('div');
            type.className = 'bar-type';
            type.textContent = bar.type;
            
            const address = document.createElement('div');
            address.className = 'bar-address';
            address.textContent = `${bar.address} â€¢ ${bar.distance} km`;
            
            const features = document.createElement('div');
            features.className = 'bar-features';
            bar.features.slice(0, 8).forEach(f => {
                const badge = document.createElement('span');
                badge.className = 'feature-badge';
                badge.textContent = findFilterLabel(f);
                features.appendChild(badge);
            });
            if (bar.features.length > 8) {
                const more = document.createElement('span');
                more.className = 'feature-badge';
                more.textContent = `+${bar.features.length - 8}`;
                features.appendChild(more);
            }
            
            card.appendChild(name);
            card.appendChild(type);
            card.appendChild(address);
            card.appendChild(features);
            
            if (withActions) {
                const actions = document.createElement('div');
                actions.className = 'btn-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'btn-edit';
                editBtn.textContent = 'âœï¸ Modifier';
                editBtn.addEventListener('click', () => editBar(bar.id));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete';
                deleteBtn.textContent = 'ğŸ—‘ï¸ Supprimer';
                deleteBtn.addEventListener('click', () => deleteBar(bar.id));
                
                actions.appendChild(editBtn);
                actions.appendChild(deleteBtn);
                card.appendChild(actions);
            }
            
            return card;
        }

        function renderBarsList() {
            const container = document.getElementById('barsListContainer');
            container.innerHTML = '';
            
            if (bars.length === 0) {
                container.innerHTML = '<div class="empty-state">Aucun bar enregistrÃ©</div>';
                return;
            }
            
            bars.forEach(bar => {
                const card = createBarCard(bar, true);
                container.appendChild(card);
            });
        }

        function showNewBarForm() {
            editingBarId = null;
            document.getElementById('barFormContainer').style.display = 'block';
            document.getElementById('barsList').style.display = 'none';
            clearForm();
        }

        function cancelEdit() {
            document.getElementById('barFormContainer').style.display = 'none';
            document.getElementById('barsList').style.display = 'block';
            clearForm();
        }

        function clearForm() {
            document.getElementById('barName').value = '';
            document.getElementById('barType').value = '';
            document.getElementById('barAddress').value = '';
            document.getElementById('barDistance').value = '';
            
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('#formFiltersContainer .filter-item').forEach(item => {
                item.classList.remove('active');
            });
        }

        function editBar(id) {
            const bar = bars.find(b => b.id === id);
            if (!bar) return;
            
            editingBarId = id;
            document.getElementById('barFormContainer').style.display = 'block';
            document.getElementById('barsList').style.display = 'none';
            
            document.getElementById('barName').value = bar.name;
            document.getElementById('barType').value = bar.type;
            document.getElementById('barAddress').value = bar.address;
            document.getElementById('barDistance').value = bar.distance;
            
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]').forEach(cb => {
                const isChecked = bar.features.includes(cb.value);
                cb.checked = isChecked;
                cb.closest('.filter-item').classList.toggle('active', isChecked);
            });
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveBar() {
            const name = document.getElementById('barName').value.trim();
            const type = document.getElementById('barType').value.trim();
            const address = document.getElementById('barAddress').value.trim();
            const distance = parseFloat(document.getElementById('barDistance').value) || 0;
            
            if (!name || !type || !address) {
                showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const features = [];
            document.querySelectorAll('#formFiltersContainer input[type="checkbox"]:checked').forEach(cb => {
                features.push(cb.value);
            });
            
            if (editingBarId) {
                const index = bars.findIndex(b => b.id === editingBarId);
                if (index !== -1) {
                    bars[index] = { ...bars[index], name, type, address, distance, features };
                    showNotification('âœ… Bar modifiÃ© !');
                }
            } else {
                const id = bars.length > 0 ? Math.max(...bars.map(b => b.id)) + 1 : 1;
                bars.push({ id, name, type, address, distance, features });
                showNotification('âœ… Bar crÃ©Ã© !');
            }
            
            bars = sortBarsByName(bars);
            saveBars();
            cancelEdit();
            renderBarsList();
            updateCounts();
        }

        function deleteBar(id) {
            const bar = bars.find(b => b.id === id);
            if (!bar) return;
            
            if (!confirm(`Supprimer "${bar.name}" ?`)) return;
            
            bars = bars.filter(b => b.id !== id);
            saveBars();
            showNotification('ğŸ—‘ï¸ Bar supprimÃ©');
            renderBarsList();
            updateCounts();
        }

        function updateCounts() {
            const count = bars.length;
            document.getElementById('totalBars').textContent = count;
            document.getElementById('barsCount').textContent = count;
        }

        function showNotification(message, type = 'success') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            if (type === 'error') {
                notif.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            }
            notif.textContent = message;
            document.body.appendChild(notif);
            setTimeout(() => {
                if (notif.parentNode) notif.remove();
            }, 3000);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            if (tabName === 'recherche') {
                performSearch();
            }
        }

        function scrollToFilters() {
            const filtersSection = document.getElementById('searchFiltersContainer');
            filtersSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function init() {
            loadBars();
            generateFormFilters();
            generateSearchFilters();
            renderBarsList();
            updateSelectedFilters();
            performSearch();
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            document.getElementById('newBarBtn').addEventListener('click', showNewBarForm);
            document.getElementById('saveBtn').addEventListener('click', saveBar);
            document.getElementById('cancelBtn').addEventListener('click', cancelEdit);
            document.getElementById('addFilterBtn').addEventListener('click', scrollToFilters);
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                const value = searchInput.value.trim();
                if (value.includes('+')) {
                    const parts = value.split('+').map(p => p.trim().toLowerCase()).filter(p => p);
                    parts.forEach(part => {
                        for (const category in FILTERS) {
                            const filter = FILTERS[category].find(f => 
                                f.label.toLowerCase().includes(part) || f.id.toLowerCase().includes(part)
                            );
                            if (filter && !selectedSearchFilters.includes(filter.id)) {
                                selectedSearchFilters.push(filter.id);
                            }
                        }
                    });
                    searchInput.value = '';
                    updateSearchFilterUI();
                    updateSelectedFilters();
                }
                performSearch();
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>